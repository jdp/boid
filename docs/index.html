<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Boid.io</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
        <a class="source" href="Boid.html">Boid.io</a>
        <a class="source" href="Environment.html">Environment.io</a>
        <a class="source" href="Git.html">Git.io</a>
        <a class="source" href="Package.html">Package.io</a>
        </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>Boid.io</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h2>Boid</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p> Boid is a package manager for the <a href="http://iolanguage.com">Io language</a>, modeled after
 tools like <a href="http://hellorip.com">Rip</a> and <a href="http://pypi.python.org/pypi/virtualenv">virtualenv</a>. Its main goal is to allow
 programmers to maintain individual <em>environments</em> in which packages can be
 installed, even different versions of the same package. To prevent
 inconsistencies, only one environment can be active at a time and can only
 have one version of a package in it.</p>

<p> Boid tries to be flexible in what is considered a <em>package</em>. Files,
 directories, and version control system checkouts can all be considered
 packages by Boid.</p>

<p> When Boid is installed, it creates a <strong>~/.boid</strong> directory for the user who
 installed it. Every environment is stored within it as its own directory,
 with a symlink called <strong>active</strong> pointing to the directory of the active
 environment.</p>

<p> The Boid directory structure looks like this when it is installed:</p>

<pre><code>.boid/
  active@
  base/
    bin/
    io/
</code></pre>

<p> The <strong>base/</strong> directory is the environment created by default, and starts as
 the active directory. For information about the directory structure of
 environments, check out the <a href="Environment.html">environment annotations</a>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        <h3>Imports</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        <p> Io is a strange creature, some objects need to be referenced before they can
 be used in the script.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">Regex</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        <p> A specialized <code>Exception</code> object is used by Boid when exceptions are thrown.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">BoidError</span> <span class="o">:=</span> <span class="n">Exception</span> <span class="k">clone</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <h3>The Meat of it All</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p> The Boid object acts as a dispatcher. Calls to <code>install</code> and <code>uninstall</code> are
 delegated to other objects to actually do all the work.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">Boid</span> <span class="o">:=</span> <span class="n">Object</span> <span class="k">clone</span> <span class="k">do</span><span class="o">(</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        <p> The <code>boidDir</code> method returns a <code>Directory</code> object with the path
 contained in the <code>BOIDDIR</code> environment variable. The setup script by
 default will set <code>BOIDDIR</code> to <code>~/.boid</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">boidDir</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span>
    <span class="n">boidDirEnv</span> <span class="o">:=</span> <span class="n">System</span> <span class="n">getEnvironmentVariable</span><span class="o">(</span><span class="s">&quot;BOIDDIR&quot;</span><span class="o">)</span>
    <span class="n">boidDirEnv</span> <span class="n">ifNil</span><span class="o">(</span><span class="n">fail</span><span class="o">(</span><span class="s">&quot;BOIDDIR environment variable not set&quot;</span><span class="o">))</span>
    <span class="n">Directory</span> <span class="n">with</span><span class="o">(</span><span class="n">boidDirEnv</span><span class="o">))</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        <p> This returns a <code>Directory</code> object that points to the binary directory
 of the active package. Normally it will be <strong>~/.boid/active/bin</strong>, where
 <strong>active</strong> is actually a symbolic link to the directory of the current
 environment.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">binDir</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">Directory</span> <span class="n">with</span><span class="o">(</span><span class="n">boidDir</span> <span class="n">path</span> <span class="o">..</span> <span class="s">&quot;/active/bin&quot;</span><span class="o">))</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        <p> This <code>Directory</code> object that points to the Io source directory of the
 active environment, which is what is reflected in the <code>IOIMPORT</code>
 environment variable.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">ioDir</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">Directory</span> <span class="n">with</span><span class="o">(</span><span class="n">boidDir</span> <span class="n">path</span> <span class="o">..</span> <span class="s">&quot;/active/io&quot;</span><span class="o">))</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        <p> Checks whether or not the <code>boidDir</code>, <code>binDir</code>, and <code>ioDir</code> paths exist.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">check</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span>
    <span class="n">list</span><span class="o">(</span><span class="n">boidDir</span><span class="o">,</span> <span class="n">binDir</span><span class="o">,</span> <span class="n">ioDir</span><span class="o">)</span> <span class="n">map</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="n">d</span> <span class="n">exists</span><span class="o">)</span> <span class="n">reduce</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="n">and</span> <span class="n">b</span><span class="o">))</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p> Package installation is done by package handlers, which are separate
 objects for each type of package that can be installed. The first handler
 that recoginizes the package specification is used to try to install the
 package.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">install</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">source</span><span class="o">,</span>
    <span class="n">handler</span> <span class="o">:=</span> <span class="n">Package</span> <span class="n">handlers</span> <span class="n">select</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">h</span> <span class="n">canHandle</span><span class="o">(</span><span class="n">source</span><span class="o">))</span> <span class="n">first</span> <span class="k">clone</span>
    <span class="n">handler</span> <span class="n">ifNil</span><span class="o">(</span>
      <span class="n">BoidError</span> <span class="n">raise</span><span class="o">(</span><span class="s">&quot;could not find appropriate package handler&quot;</span><span class="o">))</span>
    <span class="n">handler</span> <span class="n">install</span><span class="o">(</span><span class="n">source</span><span class="o">))</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        <p> Package uninstallation is also done by package handlers.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">uninstall</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">source</span><span class="o">,</span>
    <span class="n">handler</span> <span class="o">:=</span> <span class="n">Package</span> <span class="n">handlers</span> <span class="n">select</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">h</span> <span class="n">canHandle</span><span class="o">(</span><span class="n">source</span><span class="o">))</span> <span class="n">first</span> <span class="k">clone</span>
    <span class="n">handler</span> <span class="n">ifNil</span><span class="o">(</span>
      <span class="n">BoidError</span> <span class="n">raise</span><span class="o">(</span><span class="s">&quot;could not find appropriate package handler&quot;</span><span class="o">))</span>
    <span class="n">handler</span> <span class="n">uninstall</span><span class="o">(</span><span class="n">source</span><span class="o">))</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        <p> Io&rsquo;s <code>System runCommand</code> method leaves behind files from <code>stdout</code> and
 <code>stderr</code> every time it is run, we have to clean them up so the user&rsquo;s
 home directory doesn&rsquo;t get filled with garbage.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">cleanup</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span>
    <span class="n">System</span> <span class="n">system</span><span class="o">(</span><span class="s">&quot;rm -rf *-stdout&quot;</span><span class="o">)</span>
    <span class="n">System</span> <span class="n">system</span><span class="o">(</span><span class="s">&quot;rm -rf *-stderr&quot;</span><span class="o">))</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        <p> General failure handler. If anything fails for any reason, this method is
 called and boid is terminated, along with the shell status code being set
 to 1.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">fail</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span>
    <span class="s">&quot;boid: #{msg}&quot;</span> <span class="n">interpolate</span> <span class="n">println</span>
    <span class="n">System</span> <span class="n">exit</span><span class="o">(</span><span class="mf">1</span><span class="o">)))</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        <p> Include all the other source files to get the party started.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">doRelativeFile</span><span class="o">(</span><span class="s">&quot;Git.io&quot;</span><span class="o">)</span>
<span class="n">doRelativeFile</span><span class="o">(</span><span class="s">&quot;Environment.io&quot;</span><span class="o">)</span>
<span class="n">doRelativeFile</span><span class="o">(</span><span class="s">&quot;Package.io&quot;</span><span class="o">)</span></pre></div>
      </td>
    </tr>
    </table>
</div>
</body>
